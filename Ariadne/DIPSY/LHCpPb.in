cd /DIPSY

#To get output to a file, uncomment
#finalState->saveGluonsToFile(currentWeight)
#in EventFiller.cc. The events are saved to files
#~/DIPSYevents/filename/eventN.dat
#Where the directory ~/DIPSYevents/filename must exist before the run.
#Otherwise the directory can be set in DipoleState::saveGluonsToFile
#Filename is the name of the runfile, so LHCpPb or LHCpPbB01 in
#this case.

#Probably want to switch off FSR and hadronisation as well, as
#the event is saved before that.

set /Defaults/Particles/u:NominalMass 0.33
set /Defaults/Particles/d:NominalMass 0.33
set /Defaults/Particles/s:NominalMass 0.5
set /Defaults/Particles/c:NominalMass 1.5
set /Defaults/Particles/b:NominalMass 4.8

#read CurrentTune.in
read Tune31.in

read RivetAnalyses.in

create ThePEG::ProgressLog Logger ProgressLog.so
set Logger:Interval 600

set LHCpPbEventHandler:PreSamples 0
set LHCpPbEventHandler:ConsistencyLevel 0
set LHCpPbEventHandler:DecayHandler:MaxLifeTime 10
set LHCpPbEventHandler:XSecFn:CheckOffShell false
insert LHCpPbGenerator:AnalysisHandlers[0] Logger
#insert LHCpPbGenerator:AnalysisHandlers[0] HIAna
set LHCpPbGenerator:EventHandler:EventFiller:PTCut 0.6

create ThePEG::LuminosityFunction LHCpPbLabLumi
set LHCpPbEventHandler:LuminosityFunction LHCpPbLabLumi
set LHCpPbLabLumi:BeamEMaxA 2500
set LHCpPbLabLumi:BeamEMaxB 520000
set LHCpPbEventHandler:YFrametest 0.9
set LHCpPbEventHandler:BGen:Width 40
set LHCpPbEventHandler:PreSamples 1000
set LHCpPbEventHandler:PreSampleL 10
set LHCpPbEventHandler:PreSampleR 1
set LHCpPbEventHandler:PreSampleB 1
create DIPSY::SemiInclusiveXSecAnalysis SemiIncl SemiInclusiveXSecAnalysis.so
insert LHCpPbEventHandler:AnalysisHandlers[0] SemiIncl
create DIPSY::NoFluctXSecAnalysis NoFluct NoFluctXSecAnalysis.so
insert LHCpPbEventHandler:AnalysisHandlers[0] NoFluct
create DIPSY::GlauberAnalysis Glauber GlauberAnalysis.so
insert LHCpPbEventHandler:AnalysisHandlers[0] Glauber
create DIPSY::AnalysisProgress AnaLog AnalysisProgress.so
set AnaLog:Interval 600
insert LHCpPbEventHandler:AnalysisHandlers[0] AnaLog

set LHCpPbGenerator:NumberOfEvents 2
set LHCpPbEventHandler:PreSamples 10
saverun LHCpPbTestQ LHCpPbGenerator
set Lead:InterNucleonSwing Off
saverun LHCpPbTestQI LHCpPbGenerator
set Lead:InterNucleonSwing On
set LHCpPbEventHandler:PreSamples 1000
saverun LHCpPbTest0 LHCpPbGenerator
set LHCpPbEventHandler:BGen:Width 30
saverun LHCpPbTest1 LHCpPbGenerator
set LHCpPbEventHandler:PreSampleB 4
saverun LHCpPbTest2 LHCpPbGenerator
set LHCpPbEventHandler:BGen:Width 50
saverun LHCpPbTest3 LHCpPbGenerator

# Interlude with pp to get the total xsec
set LHCpPbLabLumi:BeamEMaxB 2500
set LHCpPbEventHandler:WFR stdProton
set LHCpPbEventHandler:BGen:Width 10
set LHCpPbEventHandler:YFrametest 0.5
set LHCpPbEventHandler:PreSamples 10000
set LHCpPbEventHandler:PreSampleL 1
set LHCpPbEventHandler:PreSampleB 1

saverun LHCpPbTest0pp LHCpPbGenerator
set Glauber:TotalnnXSec 89.9
set Glauber:ElasticnnXSec 22.1
set Glauber:InElasticnnXSec 58.1
saverun LHCpPbTest1pp LHCpPbGenerator
set LHCpPbEventHandler:BGen:Width 5
saverun LHCpPbTest2pp LHCpPbGenerator
set LHCpPbEventHandler:PreSampleB 16
set LHCpPbEventHandler:PreSampleL 1
set LHCpPbEventHandler:PreSampleR 1
saverun LHCpPbTest21pp LHCpPbGenerator
set LHCpPbEventHandler:PreSampleB 8
set LHCpPbEventHandler:PreSampleL 2
set LHCpPbEventHandler:PreSampleR 1
saverun LHCpPbTest22pp LHCpPbGenerator
set LHCpPbEventHandler:PreSampleB 4
set LHCpPbEventHandler:PreSampleL 2
set LHCpPbEventHandler:PreSampleR 2
saverun LHCpPbTest23pp LHCpPbGenerator
set LHCpPbEventHandler:PreSampleB 2
set LHCpPbEventHandler:PreSampleL 2
set LHCpPbEventHandler:PreSampleR 4
saverun LHCpPbTest24pp LHCpPbGenerator
set LHCpPbEventHandler:PreSampleB 1
set LHCpPbEventHandler:PreSampleL 4
set LHCpPbEventHandler:PreSampleR 4
saverun LHCpPbTest25pp LHCpPbGenerator
set LHCpPbEventHandler:PreSampleL 1
set LHCpPbEventHandler:PreSampleR 1
set LHCpPbEventHandler:PreSampleB 1

set LHCpPbEventHandler:BGen:Width 2
saverun LHCpPbTest3pp LHCpPbGenerator
set LHCpPbEventHandler:PreSamples 1000000
set LHCpPbEventHandler:BGen:Width 5
saverun LHCpPbTest4pp LHCpPbGenerator
set LHCpPbEventHandler:PreSampleB 10
saverun LHCpPbTest7pp LHCpPbGenerator
# Check lower energies
set LHCpPbLabLumi:BeamEMaxA 100
set LHCpPbLabLumi:BeamEMaxB 100
set LHCpPbEventHandler:PreSampleB 10
set Glauber:TotalnnXSec 50.04
set Glauber:ElasticnnXSec 9.197
set Glauber:InElasticnnXSec 35.98
saverun LHCpPbTest40pp LHCpPbGenerator
set Glauber:TotalnnXSec 49.92
set Glauber:ElasticnnXSec 9.176
set Glauber:InElasticnnXSec 35.89
saverun LHCpPbTest41pp LHCpPbGenerator
set Glauber:TotalnnXSec 89.9
set Glauber:ElasticnnXSec 22.1
set Glauber:InElasticnnXSec 58.1
set LHCpPbEventHandler:PreSampleB 1
set LHCpPbLabLumi:BeamEMaxA 2500
set LHCpPbLabLumi:BeamEMaxB 2500

set LHCpPbEventHandler:PreSamples 10000
set LHCpPbEventHandler:PreSampleL 10
saverun LHCpPbTest5pp LHCpPbGenerator
set LHCpPbEventHandler:PreSamples 100000
saverun LHCpPbTest50pp LHCpPbGenerator
set LHCpPbEventHandler:PreSamples 20000
set LHCpPbEventHandler:PreSampleL 5
saverun LHCpPbTest6pp LHCpPbGenerator
set LHCpPbEventHandler:PreSamples 200000
saverun LHCpPbTest60pp LHCpPbGenerator

set LHCpPbEventHandler:PreSampleL 1
set LHCpPbEventHandler:YFrametest 0.9
set LHCpPbEventHandler:PreSamples 10000
saverun LHCpPbTest4pp9 LHCpPbGenerator
set LHCpPbEventHandler:YFrametest 0.5

set LHCpPbLabLumi:BeamEMaxB 40000
set LHCpPbEventHandler:WFR Oxygen
set LHCpPbEventHandler:BGen:Width 20
set LHCpPbEventHandler:PreSamples 10
set LHCpPbEventHandler:PreSampleB 10
set LHCpPbEventHandler:PreSampleL 2
saverun LHCpPbTest0O LHCpPbGenerator
set LHCpPbEventHandler:PreSampleB 1
set LHCpPbEventHandler:PreSamples 10000
saverun LHCpPbTest1O LHCpPbGenerator
set LHCpPbEventHandler:PreSamples 100000
saverun LHCpPbTest2O LHCpPbGenerator

set LHCpPbLabLumi:BeamEMaxB 157500
set LHCpPbEventHandler:WFR Copper
set LHCpPbEventHandler:BGen:Width 20
set LHCpPbEventHandler:PreSamples 4
saverun LHCpPbTest0Cu LHCpPbGenerator
set LHCpPbEventHandler:PreSamples 1000
saverun LHCpPbTest1Cu LHCpPbGenerator
set LHCpPbEventHandler:PreSamples 4000
saverun LHCpPbTest2Cu LHCpPbGenerator
set LHCpPbEventHandler:PreSamples 1000
set LHCpPbEventHandler:PreSampleB 4
saverun LHCpPbTest3Cu LHCpPbGenerator
set LHCpPbEventHandler:PreSampleB 40
saverun LHCpPbTest4Cu LHCpPbGenerator
set Copper:InterNucleonSwing Off
saverun LHCpPbTest5Cu LHCpPbGenerator
set Copper:InterNucleonSwing On

set LHCpPbLabLumi:BeamEMaxB 520000
set LHCpPbEventHandler:WFR Lead
set LHCpPbEventHandler:YFrametest 0.9
set LHCpPbEventHandler:PreSampleL 10
set LHCpPbEventHandler:PreSampleB 4



set Glauber:TotalnnXSec 50.04
set Glauber:ElasticnnXSec 9.197
set Glauber:InElasticnnXSec 35.98
set LHCpPbLabLumi:BeamEMaxA 100
set LHCpPbLabLumi:BeamEMaxB 20800
set LHCpPbEventHandler:PreSamples 10000
set LHCpPbEventHandler:BGen:Width 40
set LHCpPbEventHandler:PreSampleB 1
saverun RHICpPbTest0 LHCpPbGenerator
set LHCpPbEventHandler:BGen:Width 20
set LHCpPbEventHandler:PreSampleB 40
set LHCpPbEventHandler:PreSampleL 1
set LHCpPbEventHandler:PreSamples 10000
set LHCpPbEventHandler:YFrametest 0.5
saverun LHCpPbTest40Pb LHCpPbGenerator
set Lead:InterNucleonSwing Off
saverun LHCpPbTest50Pb LHCpPbGenerator
set Lead:InterNucleonSwing On
set Glauber:TotalnnXSec 49.92
set Glauber:ElasticnnXSec 9.176
set Glauber:InElasticnnXSec 35.89
set LHCpPbEventHandler:PreSamples 1000
saverun LHCpPbTest41Pb LHCpPbGenerator
set LHCpPbEventHandler:PreSamples 10000
set Lead:InterNucleonSwing Off
saverun LHCpPbTest51Pb LHCpPbGenerator
set Lead:InterNucleonSwing On



#Not sure what CoM energy they will run at. 4TeV is about same
#nucleon-nucleon as PbPb.
set LHCpPbLumi:Energy 400.0

#Run with fix impact parameter, like in AA.
#This generates events in a ring. The weight
#(with interaction probability of 1) will automatically
#be set to 1, 3, 5, 7 in the B-ranges 0-1, 1-2, 2-3, etc, so
#nothing should have to be micromanaged with the weights,
#as long as the events are run in the below B rings.
#With equal amount of events in all rings (out to where int prob
#is very low), one can then find expectation values by average over
#all events, with the provided weights.
create DIPSY::FixedImpactGenerator FixedB FixedImpactGenerator.so
set LHCpPbGenerator:EventHandler:BGen FixedB

#AA has 1000 events per ring.
#pPb will run much faster, but maybe not take that much less memory.
#See how much time/space you got.
set LHCpPbGenerator:NumberOfEvents 1000

set FixedB:MinB = 0.0
set FixedB:MaxB = 1.0
saverun LHCpPbB01 LHCpPbGenerator

set FixedB:MinB = 1.0
set FixedB:MaxB = 2.0
saverun LHCpPbB12 LHCpPbGenerator

set FixedB:MinB = 2.0
set FixedB:MaxB = 3.0
saverun LHCpPbB23 LHCpPbGenerator

#etc.
#I ran Au-Au up to B=15, and PbPb to 19.
#So up to 15 should be enough here.
#See where the weight start dropping of too much.
